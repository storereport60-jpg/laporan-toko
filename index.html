<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sistem Laporan Toko</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<style>
:root{
 --primary:#2563eb;
 --bg:#f3f4f6;
 --text:#111827;
 --muted:#6b7280;
 --border:#e5e7eb;
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Inter,system-ui,Arial;
 background:var(--bg);
 color:var(--text);
}
.center{
 min-height:100vh;
 display:flex;
 align-items:center;
 justify-content:center;
 padding:20px;
}
.card{
 background:#fff;
 border-radius:16px;
 padding:35px;
 box-shadow:0 10px 30px rgba(0,0,0,.08);
 width:100%;
 max-width:420px;
}
h1{
 margin:0 0 8px;
 text-align:center;
 font-size:26px;
}
.subtitle{
 text-align:center;
 color:var(--muted);
 margin-bottom:25px;
}
label{
 font-size:13px;
 font-weight:600;
 margin-bottom:6px;
 display:block;
}
input{
 width:100%;
 padding:14px;
 border-radius:10px;
 border:1px solid var(--border);
 font-size:15px;
}
input:focus{
 outline:none;
 border-color:var(--primary);
 box-shadow:0 0 0 2px rgba(37,99,235,.15);
}
button{
 cursor:pointer;
 border:none;
 border-radius:10px;
 padding:14px;
 font-size:15px;
 font-weight:600;
}
.primary{
 background:var(--primary);
 color:#fff;
 width:100%;
 margin-top:15px;
}
.primary:hover{background:#1d4ed8}
.app{
 padding:20px;
 max-width:1300px;
 margin:auto;
}
.top{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-bottom:10px;
 flex-wrap:wrap;
 gap:10px;
}
.badge{
 background:#eef2ff;
 color:#3730a3;
 padding:6px 12px;
 border-radius:999px;
 font-size:13px;
 font-weight:600;
}
.menu{
 display:flex;
 gap:10px;
 flex-wrap:wrap;
 margin:15px 0;
}
.menu button{
 padding:10px 14px;
 border-radius:8px;
 background:#e5e7eb;
}
.menu button:hover{background:#d1d5db}
.frame-box{
 background:#fff;
 border-radius:12px;
 padding:12px;
 box-shadow:0 6px 18px rgba(0,0,0,.08);
}
.frame-actions{
 display:flex;
 justify-content:flex-end;
 gap:10px;
 margin-bottom:10px;
}
iframe{
 width:100%;
 height:75vh;
 border:none;
 border-radius:10px;
}
.logout{
 background:#ef4444;
 color:#fff;
}
.logout:hover{background:#dc2626}
.refresh{
 background:#0ea5e9;
 color:#fff;
}
.refresh:hover{background:#0284c7}
</style>
</head>
<body>
<div id="root"></div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey:"ISI_APIKEY_MU",
  authDomain:"ISI_AUTHDOMAIN",
  projectId:"ISI_PROJECTID"
});
const db = firebase.firestore();

/* ================= APP ================= */
const e = React.createElement;
function App(){
 const [user,setUser]=React.useState(null);
 const [username,setUsername]=React.useState("");
 const [data,setData]=React.useState(null);
 const [src,setSrc]=React.useState("");

 function login(){
  if(!username) return alert("Username wajib diisi");
  db.collection("users").doc(username).get().then(d=>{
    if(!d.exists) return alert("User tidak terdaftar");
    const v=d.data();
    if(v.expired && new Date(v.expired)<new Date())
      return alert("Masa aktif user sudah habis");
    setUser(username);
    setData(v);
  });
 }

 function logout(){
  if(confirm("Logout sekarang?")){
    setUser(null);
    setUsername("");
    setSrc("");
  }
 }

 function openReport(type){
  let base="https://app.alfastore.co.id/prd/api/rpt/laporan/";
  let url="";
  if(type==="last") url="selisih_terakhir";
  if(type==="adjust") url="so_adjust";
  if(type==="daily") url="daily_performance";
  if(type==="notmain") url="plu_tidak_main";
  if(type==="disc") url="discontinue";
  if(type==="2324") url="rep_gabungan_23_24";
  setSrc(base+url+"?storeId="+data.storeId+"&r="+Date.now());
 }

 if(!user){
  return e("div",{className:"center"},
   e("div",{className:"card"},
    e("h1",null,"Login Sistem"),
    e("div",{className:"subtitle"},"Masukkan username terdaftar"),
    e("label",null,"Username"),
    e("input",{
      value:username,
      onChange:i=>setUsername(i.target.value.toUpperCase()),
      placeholder:"USERNAME"
    }),
    e("button",{className:"primary",onClick:login},"Masuk")
   )
  );
 }

 return e("div",{className:"app"},
  e("div",{className:"top"},
    e("div",null,
      e("b",null,"Halo, "+user),
      " ",
      e("span",{className:"badge"},"Aktif s/d "+(data.expired||"-"))
    )
  ),

  e("div",{className:"menu"},
    e("button",{onClick:()=>openReport("last")},"Selisih Terakhir"),
    e("button",{onClick:()=>openReport("adjust")},"SO Adjust"),
    e("button",{onClick:()=>openReport("daily")},"Daily Performance"),
    e("button",{onClick:()=>openReport("notmain")},"PLU Tidak Main"),
    e("button",{onClick:()=>openReport("disc")},"Discontinue"),
    e("button",{onClick:()=>openReport("2324")},"ðŸ“Š Laporan 23â€“24")
  ),

  src && e("div",{className:"frame-box"},
    e("div",{className:"frame-actions"},
      e("button",{className:"refresh",onClick:()=>setSrc(src+"&r="+Date.now())},"ðŸ”„ Refresh"),
      e("button",{className:"logout",onClick:logout},"ðŸšª Logout")
    ),
    e("iframe",{src})
  )
 );
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>
</body>
</html>
