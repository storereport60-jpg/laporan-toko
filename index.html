<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel - User Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
body{font-family:Arial;background:#eef2f6;margin:0}
.card{background:#fff;border-radius:8px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.container{max-width:1100px;margin:30px auto}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #ddd;text-align:left}
th{background:#f5f5f5}
input,button{padding:8px;border-radius:6px;border:1px solid #ccc}
button{cursor:pointer;border:none;color:#fff;font-weight:600}
.primary{background:#1e88e5}
.success{background:#43a047}
.warning{background:#fb8c00}
.danger{background:#e53935}
.hidden{display:none}
</style>
</head>

<body>

<div class="container">
  <!-- LOGIN ADMIN -->
  <div id="login" class="card">
    <h2>üîê Admin Login</h2>
    <input id="pin" type="password" placeholder="Masukkan PIN Admin">
    <button class="primary" onclick="loginAdmin()">LOGIN</button>
  </div>

  <!-- PANEL -->
  <div id="panel" class="card hidden">
    <h2>üßë‚Äçüíº Admin Panel</h2>

    <h3>‚ûï Tambah User</h3>
    <input id="u" placeholder="Username">
    <input id="s" placeholder="Store ID">
    <input id="e" type="date">
    <button class="success" onclick="addUser()">Tambah</button>

    <h3 style="margin-top:20px">üìã Daftar User</h3>
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Store</th>
          <th>Expired</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>

    <button class="danger" style="margin-top:15px" onclick="logout()">Logout</button>
  </div>
</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyCld9VE6XdF-tbcv1E-gBZ2ACeJBklW-Go",
  authDomain: "server-laporan.firebaseapp.com",
  databaseURL: "https://server-laporan-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "server-laporan"
});
const db = firebase.database();

/* ================= CONFIG ================= */
const ADMIN_PIN = "261261"; // üî¥ GANTI PIN INI

/* ================= LOGIN ================= */
function loginAdmin(){
  if(document.getElementById("pin").value !== ADMIN_PIN){
    alert("PIN salah"); return;
  }
  document.getElementById("login").classList.add("hidden");
  document.getElementById("panel").classList.remove("hidden");
  loadUsers();
}

/* ================= USER CRUD ================= */
function loadUsers(){
  db.ref("userList").on("value",snap=>{
    const data = snap.val() || {};
    const tbody = document.getElementById("list");
    tbody.innerHTML="";
    Object.keys(data).forEach(id=>{
      const u = data[id];
      tbody.innerHTML += `
        <tr>
          <td>${u.username}</td>
          <td>${u.storeId}</td>
          <td>${u.expired}</td>
          <td>
            <button class="warning" onclick="editUser('${id}')">Edit</button>
            <button class="danger" onclick="delUser('${id}')">Hapus</button>
          </td>
        </tr>`;
    });
  });
}

function addUser(){
  const u=document.getElementById("u").value;
  const s=document.getElementById("s").value;
  const e=document.getElementById("e").value;
  if(!u||!s||!e) return alert("Lengkapi data");

  db.ref("userList").push({
    username:u,
    storeId:s,
    expired:e
  });

  document.getElementById("u").value="";
  document.getElementById("s").value="";
  document.getElementById("e").value="";
}

function delUser(id){
  if(confirm("Hapus user ini?"))
    db.ref("userList/"+id).remove();
}

function editUser(id){
  const u=prompt("Username baru:");
  const s=prompt("Store ID baru:");
  const e=prompt("Expired (YYYY-MM-DD):");
  if(u&&s&&e)
    db.ref("userList/"+id).set({username:u,storeId:s,expired:e});
}

function logout(){
  location.reload();
}
</script>

</body>
</html>
